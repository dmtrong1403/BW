<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:pfx="http://www.tibco.com/pe/DeployedVarsType" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <pd:name>Apps/Global/OperationAvailibility/Version1.0/History/HistoryRefinery.process</pd:name>
    <pd:startName>Timer</pd:startName>
    <pd:startX>0</pd:startX>
    <pd:startY>0</pd:startY>
    <pd:returnBindings/>
    <pd:starter name="Timer">
        <pd:type>com.tibco.plugin.timer.TimerEventSource</pd:type>
        <pd:resourceType>ae.activities.timer</pd:resourceType>
        <pd:x>78</pd:x>
        <pd:y>169</pd:y>
        <config>
            <StartTime>1477410835000</StartTime>
            <Frequency>true</Frequency>
            <TimeInterval>1</TimeInterval>
            <FrequencyIndex>Second</FrequencyIndex>
        </config>
        <pd:inputBindings/>
    </pd:starter>
    <pd:endName>End</pd:endName>
    <pd:endX>913</pd:endX>
    <pd:endY>164</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1477389169409</pd:targetNamespace>
    <pd:group name="IterateYearList">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>176</pd:x>
        <pd:y>5</pd:y>
        <pd:width>692</pd:width>
        <pd:height>308</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/YearList, ",")</pd:over>
            <pd:indexSlot>k</pd:indexSlot>
            <pd:activityOutputName/>
            <pd:accumulateOutput>false</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>IterateMonthList</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>IterateMonthList</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:group name="IterateMonthList">
            <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
            <pd:resourceType>ae.process.group</pd:resourceType>
            <pd:x>206</pd:x>
            <pd:y>38</pd:y>
            <pd:width>575</pd:width>
            <pd:height>254</pd:height>
            <pd:collapsedWidth>57</pd:collapsedWidth>
            <pd:collapsedHeight>70</pd:collapsedHeight>
            <pd:groupVariables/>
            <pd:joinToggle>inherit</pd:joinToggle>
            <config>
                <pd:groupType>inputLoop</pd:groupType>
                <pd:serializable>false</pd:serializable>
                <pd:over>tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/MonthList, ",")</pd:over>
                <pd:indexSlot>j</pd:indexSlot>
                <pd:activityOutputName/>
                <pd:accumulateOutput>false</pd:accumulateOutput>
            </config>
            <pd:inputBindings/>
            <pd:expanded>true</pd:expanded>
            <pd:transition>
                <pd:from>start</pd:from>
                <pd:to>IterateUnitList</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>IterateUnitList</pd:from>
                <pd:to>end</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:group name="IterateUnitList">
                <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
                <pd:resourceType>ae.process.group</pd:resourceType>
                <pd:x>236</pd:x>
                <pd:y>72</pd:y>
                <pd:width>507</pd:width>
                <pd:height>184</pd:height>
                <pd:collapsedWidth>57</pd:collapsedWidth>
                <pd:collapsedHeight>70</pd:collapsedHeight>
                <pd:groupVariables/>
                <pd:joinToggle>inherit</pd:joinToggle>
                <config>
                    <pd:groupType>inputLoop</pd:groupType>
                    <pd:serializable>false</pd:serializable>
                    <pd:over>tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/UnitList, ",")</pd:over>
                    <pd:iterationElementSlot/>
                    <pd:indexSlot>i</pd:indexSlot>
                    <pd:activityOutputName/>
                    <pd:accumulateOutput>false</pd:accumulateOutput>
                </config>
                <pd:inputBindings/>
                <pd:expanded>true</pd:expanded>
                <pd:transition>
                    <pd:from>start</pd:from>
                    <pd:to>DeleteOAData</pd:to>
                    <pd:lineType>Default</pd:lineType>
                    <pd:lineColor>-16777216</pd:lineColor>
                    <pd:conditionType>always</pd:conditionType>
                </pd:transition>
                <pd:transition>
                    <pd:from>CalculateOARefinery</pd:from>
                    <pd:to>end</pd:to>
                    <pd:lineType>Default</pd:lineType>
                    <pd:lineColor>-16777216</pd:lineColor>
                    <pd:conditionType>always</pd:conditionType>
                </pd:transition>
                <pd:transition>
                    <pd:from>DeleteOAData</pd:from>
                    <pd:to>GetUnitName</pd:to>
                    <pd:lineType>Default</pd:lineType>
                    <pd:lineColor>-16777216</pd:lineColor>
                    <pd:conditionType>always</pd:conditionType>
                </pd:transition>
                <pd:transition>
                    <pd:from>GetUnitName</pd:from>
                    <pd:to>DeleteOADetailsData</pd:to>
                    <pd:lineType>Default</pd:lineType>
                    <pd:lineColor>-16777216</pd:lineColor>
                    <pd:conditionType>always</pd:conditionType>
                </pd:transition>
                <pd:transition>
                    <pd:from>DeleteOADetailsData</pd:from>
                    <pd:to>CalculateOARefinery</pd:to>
                    <pd:lineType>Default</pd:lineType>
                    <pd:lineColor>-16777216</pd:lineColor>
                    <pd:conditionType>always</pd:conditionType>
                </pd:transition>
                <pd:activity name="CalculateOARefinery">
                    <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
                    <pd:resourceType>ae.process.subprocess</pd:resourceType>
                    <pd:x>656</pd:x>
                    <pd:y>172</pd:y>
                    <config>
                        <processName>/Apps/Global/OperationAvailibility/Version1.0/SubProcess/CalculateOARefineryRolling2Years.process</processName>
                        <processNameXPath>concat("/Apps/Global/OperationAvailibility/Version1.0/CalculateOARefinery",$_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/DateType,".process")</processNameXPath>
                    </config>
                    <pd:inputBindings>
                        <root>
                            <xsl:if test="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/MonthList, &quot;,&quot;)[$j]">
                                <Month>
                                    <xsl:value-of select="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/MonthList, &quot;,&quot;)[$j]"/>
                                </Month>
                            </xsl:if>
                            <xsl:if test="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/YearList, &quot;,&quot;)[$k]">
                                <Year>
                                    <xsl:value-of select="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/YearList, &quot;,&quot;)[$k]"/>
                                </Year>
                            </xsl:if>
                        </root>
                    </pd:inputBindings>
                </pd:activity>
                <pd:activity name="DeleteOAData">
                    <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
                    <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
                    <pd:x>322</pd:x>
                    <pd:y>171</pd:y>
                    <config>
                        <timeout>10</timeout>
                        <commit>false</commit>
                        <emptyStrAsNil>false</emptyStrAsNil>
                        <jdbcSharedConfig>/SharedResource/Connection/JDBC/KPIsDBConnection.sharedjdbc</jdbcSharedConfig>
                        <statement>delete from OPE_KPI_01_01 where VALID_DATE = to_date(?,'DD-MM-YY') and DATE_TYPE = ? and UNIT_ID = ?</statement>
                        <Prepared_Param_DataType>
                            <parameter>
                                <parameterName>VALID_DATE</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                            <parameter>
                                <parameterName>DATE_TYPE</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                            <parameter>
                                <parameterName>UNIT_ID</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                        </Prepared_Param_DataType>
                    </config>
                    <pd:inputBindings>
                        <jdbcUpdateActivityInput>
                            <VALID_DATE>
                                <xsl:value-of select="concat('1-', tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/MonthList, &quot;,&quot;)[$j],'-',tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/YearList, &quot;,&quot;)[$k])"/>
                            </VALID_DATE>
                            <DATE_TYPE>
                                <xsl:value-of select="$_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/DateType"/>
                            </DATE_TYPE>
                            <UNIT_ID>
                                <xsl:value-of select="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/UnitList, &quot;,&quot;)[$i]"/>
                            </UNIT_ID>
                        </jdbcUpdateActivityInput>
                    </pd:inputBindings>
                </pd:activity>
                <pd:activity name="GetUnitName">
                    <pd:type>com.tibco.plugin.jdbc.JDBCQueryActivity</pd:type>
                    <pd:resourceType>ae.activities.JDBCQueryActivity</pd:resourceType>
                    <pd:x>421</pd:x>
                    <pd:y>170</pd:y>
                    <config>
                        <timeout>10</timeout>
                        <commit>false</commit>
                        <maxRows>100</maxRows>
                        <emptyStrAsNil>false</emptyStrAsNil>
                        <jdbcSharedConfig>/SharedResource/Connection/JDBC/DWHConnection.sharedjdbc</jdbcSharedConfig>
                        <statement>select * from WEBINPUT.UNIT where UNIT_ID = ?</statement>
                        <Prepared_Param_DataType>
                            <parameter>
                                <parameterName>UnitID</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                        </Prepared_Param_DataType>
                        <oraObjects/>
                        <oraTables/>
                        <QueryOutputCachedSchemaColumns>UNIT_ID</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>UNIT_CODE</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>UNIT_NAME</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>DESCRIPTION</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>DESIGNCAPACITY</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>UOM_ID</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>EDC_CONSTANT</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>AREA</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>CREATE_USER_ID</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>CREATE_TIME</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>93</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>DATE</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>UPDATE_USER_ID</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                        <QueryOutputCachedSchemaColumns>UPDATE_TIME</QueryOutputCachedSchemaColumns>
                        <QueryOutputCachedSchemaDataTypes>93</QueryOutputCachedSchemaDataTypes>
                        <QueryOutputCachedSchemaDataTypesName>DATE</QueryOutputCachedSchemaDataTypesName>
                        <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
                    </config>
                    <pd:inputBindings>
                        <jdbcQueryActivityInput>
                            <UnitID>
                                <xsl:value-of select="tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/UnitList, &quot;,&quot;)[$i]"/>
                            </UnitID>
                        </jdbcQueryActivityInput>
                    </pd:inputBindings>
                </pd:activity>
                <pd:activity name="DeleteOADetailsData">
                    <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
                    <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
                    <pd:x>530</pd:x>
                    <pd:y>171</pd:y>
                    <config>
                        <timeout>10</timeout>
                        <commit>false</commit>
                        <emptyStrAsNil>false</emptyStrAsNil>
                        <jdbcSharedConfig>/SharedResource/Connection/JDBC/KPIsDBConnection.sharedjdbc</jdbcSharedConfig>
                        <statement>delete from OPE_KPI_01_01_DETAILS where VALID_DATE = to_date(?,'DD-MM-YY') and DATE_TYPE = ? and UNIT = ?</statement>
                        <Prepared_Param_DataType>
                            <parameter>
                                <parameterName>VALID_DATE</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                            <parameter>
                                <parameterName>DATE_TYPE</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                            <parameter>
                                <parameterName>UNIT</parameterName>
                                <dataType>VARCHAR</dataType>
                            </parameter>
                        </Prepared_Param_DataType>
                    </config>
                    <pd:inputBindings>
                        <jdbcUpdateActivityInput>
                            <VALID_DATE>
                                <xsl:value-of select="concat('1-', tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/MonthList, &quot;,&quot;)[$j],'-',tib:tokenize($_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/YearList, &quot;,&quot;)[$k])"/>
                            </VALID_DATE>
                            <DATE_TYPE>
                                <xsl:value-of select="$_globalVariables/pfx:GlobalVariables/APPsInfo/ManualRunning/OPE_01_01/CalculateUnits/DateType"/>
                            </DATE_TYPE>
                            <UNIT>
                                <xsl:choose>
                                    <xsl:when test="exists($GetUnitName/resultSet/Record[1]/UNIT_NAME)">
                                        <xsl:value-of select="$GetUnitName/resultSet/Record[1]/UNIT_NAME"/>
                                    </xsl:when>
                                    <xsl:otherwise>
                                        <xsl:attribute name="xsi:nil">true</xsl:attribute>
                                    </xsl:otherwise>
                                </xsl:choose>
                            </UNIT>
                        </jdbcUpdateActivityInput>
                    </pd:inputBindings>
                </pd:activity>
            </pd:group>
        </pd:group>
    </pd:group>
    <pd:transition>
        <pd:from>IterateYearList</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Timer</pd:from>
        <pd:to>IterateYearList</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>